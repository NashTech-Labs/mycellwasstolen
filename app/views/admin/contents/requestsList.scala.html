@(typ:String,users: List[(model.repository.Mobile,String,String)], user: Option[model.repository.User])(implicit flash: Flash)

@import utils.StatusUtil.Status

@views.html.admin.main("Requests",user) {
			<div class="row">
				<div id="loading col-md-6" style="float: left;" hidden="true"><img src="@routes.Assets.at("images/loading.gif")"/></div>
				<div class="col-md-6"  style="float: right; margin-bottom: 13px;">
					<a id="pending_button" href="@routes.AdminController.requestsList("pending")" class="btn btn-success btn-sm">Pending</a>
					<a id="demanded_button" href="@routes.AdminController.requestsList("proofdemanded")" class="btn btn-success btn-sm">Proof Demanded</a>
					<a id="approved_button" href="@routes.AdminController.requestsList("approved")" class="btn btn-success btn-sm">Approved</a>
					<a id="spams_button" href="@routes.AdminController.requestsList("spam")" class="btn btn-success btn-sm">Spams</a>
				</div>
			</div>
			<div class="row">
			@flash.get("error").map { message =>
                <div class="alert alert-error alert-dismissable col-md-12">
        			<strong>@message</strong>
      			</div>
            }
            @flash.get("success").map { message =>
                <div class="alert alert-success alert-dismissable col-md-12">
        			<strong>@message</strong>
      			</div>
		}
		</div>
		 <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            @Messages("admin.requestapproval")
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="dataTable_wrapper">
                            @if(users.size > 0) {
                                <table class="table table-striped table-bordered table-hover" id="requestsTable">
                                    <thead>
                            <th>@Messages("mobile.name")</th>
							<th>@Messages("mobile.model")</th>
							<th>@Messages("mobile.imei")</th>
							<th>@Messages("mobile.email")</th>
							<th>@Messages("mobile.status")</th>
							@if(typ=="approved"){
								<th>@Messages("mobile.proof")</th>
								<th>@Messages("mobile.spam")</th>
							}
							@if(typ=="pending"){
							<th>@Messages("mobile.proof")</th>
							<th>@Messages("mobile.demandProof")</th>
							<th>@Messages("mobile.approve")</th>
							<th>@Messages("mobile.spam")</th>
							}
							@if(typ=="proofdemanded"){
							<th>@Messages("mobile.proof")</th>
							<th>@Messages("mobile.approve")</th>
							<th>@Messages("mobile.spam")</th>
							}
							@if(typ=="spam"){
							<th>@Messages("mobile.approve")</th>
							<th>@Messages("mobile.demandProof")</th>
							}
                        </tr>
                    </thead>
                    <tbody>
                       @for(mobile <- users) {
                        <tr>
                        <td>@mobile._1.userName</td>
			    			<td>@mobile._2</td>
			    			<td>@mobile._1.imei</td>
						    <td>@mobile._1.email</td>
							<td>@mobile._1.regType</td>
							@if(typ=="approved"){
								<td><button class="btn btn-primary btn-sm" onclick="showDocumentProof('@mobile._1.document')">Get Proof</button></td>
								<td><button class="btn btn-danger btn-sm" onclick="markMobileAsSpam(@mobile._1.imei)" id = "delete" >Mark as Spam</button></td>
							}
							@if(typ=="pending"){
								<td><button class="btn btn-primary btn-sm" onclick="showDocumentProof('@mobile._1.document')">Get Proof</button></td>
							  <td><a href="@routes.AdminController.proofDemanded(mobile._1.imei,typ)" class="btn btn-primary btn-sm" id="demandProof">Demand Proof</a></td>
							<td><a href="@routes.AdminController.approve(mobile._1.imei,typ)" class="btn btn-primary btn-sm" id="approve">Approve</a></td>
							<td><button class="btn btn-danger btn-sm" onclick="markMobileAsSpam(@mobile._1.imei)" id = "delete" >Mark as Spam</button></td>
							}
							@if(typ=="proofdemanded"){
								<td><button class="btn btn-primary btn-sm" onclick="showDocumentProof('@mobile._1.document')">Get Proof</button></td>
							<td><a href="@routes.AdminController.approve(mobile._1.imei,typ)" class="btn btn-primary btn-sm" id="approve">Approve</a></td>
							<td><button class="btn btn-danger btn-sm" onclick="markMobileAsSpam(@mobile._1.imei)" id = "delete" >Mark as Spam</button></td>
							}
						    @if(typ=="spam"){
						    <td><a href="@routes.AdminController.approve(mobile._1.imei,typ)" class="btn btn-primary btn-sm" id="approve">Approve</a></td>
						    <td><a href="@routes.AdminController.proofDemanded(mobile._1.imei,typ)" class="btn btn-primary btn-sm" id="demandProof">Demand Proof</a></td>
						    }
			    		</tr>
                       }
                       </tbody>
                </table>
		} else {
			<div class="panel panel-default">
			  <div class="panel-body" style="background: #FFCCCC">
			    <em>No records!</em>
			  </div>
			</div>	
		}
                            </div>
                            </div>
                            </div>
                            </div>
                            </div>
	
	<!-- confirm modal dialog for delete mobile -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Mark Mobile as Spam?</h4>
      </div>
      <div class="modal-body" id="modalBody">Are you sure?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="deleteOk">Mark Spam</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

      <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <script type="text/javascript">
    $(document).ready(function() {
        $('#requestsTable').DataTable({
                responsive: true
        });
    });
    </script>
<script type="text/javascript">

		function showDocumentProof(documentProofId) {
			var newWindow = window.open("", "pictureViewer",
					"location=no, directories=no, resizable=yes, fullscreen=no, "
							+ "menubar=no, status=yes, toolbar=no, width="
							+ 800 + ", height=" + 700 + ", scrollbars=no");
			newWindow.document.writeln("<html>");
			newWindow.document.writeln("<body style='margin: 0 0 0 0;'>");
			newWindow.document.writeln("<a href='javascript:window.close();'>");
			newWindow.document
					.writeln('<img src=https://s3.amazonaws.com/voyager-email-attachments/'+documentProofId+'  id="bigImage"/>');
			newWindow.document.writeln("<br>");
			newWindow.document.writeln(alt = "Click to close");
			newWindow.document.writeln("</a>");
			newWindow.document.writeln("</body></html>");
			newWindow.document.close();
		}

			function markMobileAsSpam(imeid) {
				$('#myModal').modal('show');
				$("#deleteOk").bind('click', function(){
					var statusAjaxCallBackForDeleteMobileUser = {
							success : ajaxSuccess,
							error : ajaxError
						};
						jsRoutes.controllers.AdminController.markMobileAsSpam(imeid)
								.ajax(statusAjaxCallBackForDeleteMobileUser);
						$('#myModal').modal('hide');
				});
			}

		var ajaxSuccess = function(data) {
		  console.debug("Success of delete mobile Ajax Call");
		  window.location.reload(true);
		};
		 
		var ajaxError = function(error) {
			console.debug("Error in delete mobile Ajax Call");
		};
	</script>
	}
