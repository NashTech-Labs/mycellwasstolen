@(mobiles: List[model.domains.Domain.Mobile], user: Option[model.domains.Domain.User])(implicit flash: Flash)

@import model.domains.Domain.Status
@main("Mycellwasstolen",user) {

	<div class="content-body span10">
		<div class="well">
			<div class="row">
				<div class="span6" style="padding-left: 20px;">
					<h3>@Messages("admin.requestapproval")</h3>
				</div>
				<div class="span6">
					<button class="btn btn-info" style="float: right; id="pending_button" onclick="getMobilesByStatus('pending');" >Pending</button>
					<button class="btn btn-info" style="float: right; id="pending_button" onclick="getMobilesByStatus('proofdemanded');" >Proof Demanded</button>
					<button class="btn btn-info" style="float: right; id="pending_button" onclick="getMobilesByStatus('approved');" >Approved</button>
				</div>
			</div>
			@flash.get("error").map { message =>
                <div class="alert alert-error">
        			<strong>@message</strong>
      			</div>
            }
            
            @flash.get("success").map { message =>
                <div class="alert alert-success">
        			<strong>@message</strong>
      			</div>
		}
<div id="emptylistmessage">
		@if(mobiles.size >= 0) {
            	<table id="mobileTable" cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered">
            		<thead>
						<tr>
							<th>@Messages("mobile.name")</th>
							<th>@Messages("mobile.model")</th>
							<th>@Messages("mobile.imei")</th>
							<th>@Messages("mobile.purchaseDate")</th>
							<th>@Messages("mobile.email")</th>
							<th>@Messages("mobile.approval")</th>
							<th>@Messages("mobile.status")</th>
							<th>@Messages("mobile.proof")</th>
							<th>@Messages("mobile.approve")</th>
							<th>@Messages("mobile.demandProof")</th>
							<th>@Messages("mobile.registrationTime")</th>
						</tr>
					</thead>
					<tbody id="mobileData">
           			@for(mobile <- mobiles) {
			    		<tr>
			    			<td>@mobile.mobileName</td>
			    			<td>@mobile.mobileModel</td>
			    			<td>@mobile.imeiMeid</td>
			    			<td>@mobile.purchaseDate</td>
			    			<td>@mobile.email</td>
			    			<td id="status_@mobile.imeiMeid">@mobile.mobileStatus</td>
			    			<td>@mobile.regType</td>
			    			<td>
								<button class="btn btn-info" onclick="showDocumentProof('@mobile.document');">Get Proof</button> <!-- Modal -->
								<div class="modal fade" id="myModal_@mobile.imeiMeid" tabindex="-1" role="dialog"
									aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal"
													aria-hidden="true">&times;</button>
												<h4 class="modal-title" id="myModalLabel">Proof Document</h4>
											</div>
											<div class="modal-body"><img style="height: 200px;" alt="Proof Document" src="@routes.Assets.at("proofDocuments/" +mobile.document)" /></div>
											<div class="modal-footer">
												<button type="button" class="btn btn-default"
													data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div> 
					    </td>
					
					    @if(mobile.mobileStatus==Status.approved){
	    				<td>
	    					<button title="Approve" class="btn btn-info" id="approve_@mobile.imeiMeid" disabled>Approve</button>
	    				</td>
	    				} else{
	    				<td>
	    					<button title="Approve" class="btn btn-info" onClick="changeStatus(@mobile.imeiMeid);" id="approve_@mobile.imeiMeid" >Approve</button>
	    				</td>
	    				}
	    				@if(mobile.mobileStatus==Status.proofdemanded){
	    				<td>
	    					<button title="Demand Proof" class="btn btn-info"  id="demand_@mobile.imeiMeid" disabled>Demand Proof</button>
	    				</td>
	    				}else{
	    				<td>
	    					<button title="Demand Proof" class="btn btn-info"  onClick="changeStatusToDemand(@mobile.imeiMeid);" id="demand_@mobile.imeiMeid" >Demand Proof</button>
	    				</td>
	    				}
	    				<td>@mobile.regDate</td>
			    	</tr>
			    		
                      }
           			</tbody>
            	</table>
            } <!-- else {
            	<h1>@Messages("default.notShow")</h1>
            } -->
	</div>
	</div>
	</div>
	<script type="text/javascript">
	    var imeId = "";
	    
	    function changeStatusToDemand(imeid) {
			imeId = imeid;
			changeStatusToDemandProof(imeid);
			sendMailForDemandProof(imeid); // for mail 
		}
	    
	    var statusAjaxSuccessDemandProof = function(data) {
			$("#demand_"+imeId).prop("disabled",true);
			$("#demand_"+imeId).text('Proof Demanded');
			console.debug("Success of Ajax Call for demand proof");
			console.debug(data);
		};
		
		var statusAjaxErrorDemandProof = function(err) {
			console.debug("Error of ajax Call for demand proof");
			console.debug(err);
		};
		
		var changeStatusToDemandProof = function(imeid) {
        	
        	var statusAjaxCallBackDemandProof = {
    			success: statusAjaxSuccessDemandProof,
    			error: statusAjaxErrorDemandProof
    		};
        	
        	jsRoutes.controllers.AdminController.proofDemanded(imeid).ajax(statusAjaxCallBackDemandProof);
        };
        
        var sendMailForDemandProof=function(imeid){
        	var statusAjaxCallBackForSendMail={
        			success: statusAjaxSuccessForSendmail,
        			error: statusAjaxErrorForSendmail	
        	};
        	jsRoutes.controllers.AdminController.sendMailForDemandProof(imeid).ajax(statusAjaxCallBackForSendMail)
        };
        
        var statusAjaxSuccessForSendmail = function(data) {
			console.debug("Success of Ajax Call");
			console.debug(data);
		};
		
		var statusAjaxErrorForSendmail = function(err) {
			console.debug("Error of ajax Call");
			console.debug(err);
		};
        
	    
		function changeStatus(imeid) {
			imeId = imeid;
			changeStatusToApprove(imeid);
		}
		
		var statusAjaxSuccess = function(data) {
			$("#approve_"+imeId).prop("disabled",true);
			$("#approve_"+imeId).text('approved');
			console.debug("Success of Ajax Call");
			console.debug(data);
		};
		
		var statusAjaxError = function(err) {
			console.debug("Error of ajax Call");
			console.debug(err);
		};
        
        var changeStatusToApprove = function(imeid) {
        	
        	var statusAjaxCallBack = {
    			success: statusAjaxSuccess,
    			error: statusAjaxError
    		};
        	
        	jsRoutes.controllers.AdminController.approve(imeid).ajax(statusAjaxCallBack);
        };
        
      //script for getting  mobile list by status
      
        function getMobilesByStatus(status){

        	getMobileListByStatus(status);
        }
        
        var statusAjaxSuccessForPendingMobileList = function(data){
      	 if (data.status == "Error"){
      		$('#mobileData').empty();
      		$('#mobileData').append("Requested Data are empty");
        }
      	 else{
      		// console.log(data.toSource());
      		$('#mobileData').empty();
      		$.each(data, function(index, value){
                var tBody= '<tr><td>'+value.mobileName+
                '</td><td>'+value.mobileModel+
                '</td><td>'+value.imeiMeid+
                '</td><td>'+value.purchaseDate+
                '</td><td>'+value.email+'</td><td>'
                +value.mobileStatus.name+'</td><td>'
                +value.regType+'</td><td><button class="btn btn-info" data-toggle="modal" data-target="#myModal_'+value.imeiMeid+'" onclick="showDocumentProof(\''+value.document+'\');"'
                +'>Get Proof</button></td><td>'
                //condition for disable approve button
                +(value.mobileStatus.name=="approved"?'<button title="Approve" class="btn btn-info" id="approve_'+value.imeiMeid+'" onclick="changeStatus('+value.imeiMeid+');" disabled>Approved</button>':'<button title="Approve" class="btn btn-info" id="approve_'+value.imeiMeid+'" onclick="changeStatus('+value.imeiMeid+');">Approve</button>')
                +((value.mobileStatus.name=="approved"||"proofdemanded")?'</td><td><button title="Demand Proof" class="btn btn-info" id="demand_'+value.imeiMeid+'" onclick="changeStatusToDemand('+value.imeiMeid+');" disabled >Demand Proof</button>':'</td><td><button title="Demand Proof" class="btn btn-info" id="demand_'+value.imeiMeid+'" onclick="changeStatusToDemand('+value.imeiMeid+');">Demand Proof</button>')
                +'</td>'
                +'<td>'+value.regDate+'</td></tr>';
                
                $('#mobileData').append(tBody);
      		});
      	}
      	  console.debug("Success of Ajax Call for Mobile List By Status");
  		  console.debug(data);
        };
        var statusAjaxErrorForPendingMobileList=function(err){
      	  console.debug("Error of ajax Call for Mobile List By Status");
  		  console.debug(err);
        };
        
        var getMobileListByStatus = function(status){
      	  var statusAjaxCallBackForPendingList={
      			  success: statusAjaxSuccessForPendingMobileList,
      			  error: statusAjaxErrorForPendingMobileList
      	  };
      	  
      	  jsRoutes.controllers.AdminController.mobilesForAjaxCall(status).ajax(statusAjaxCallBackForPendingList);
        };
        
        function showDocumentProof(documentProofId){
        	popupWindow = window.open('/assets/proofDocuments/'+documentProofId+'','popUpWindow','height=700,width=800,left=10,top=10,resizable=yes,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,status=yes');
        	}
       
	
	</script>
}
