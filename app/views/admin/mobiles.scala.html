@(users: List[(model.repository.Mobile,String,String)], user: Option[model.repository.User])(implicit flash: Flash)

@import utils.StatusUtil.Status

@main("Mycellwasstolen",user) {
	        <br>
	        <div class="" style="margin: 10px;">
			<div class="row">
				<div class="col-md-5">
					<h3 style="">@Messages("admin.requestapproval")</h3>
				</div>
				<div id="loading col-md-4" style="padding-left: 20px;" hidden="true"><img src="/assets/images/loading.gif"/></div>
				<div class="col-md-3"  style="float: right; padding-top: 17px;">
					<a id="pending_button" href="@routes.AdminController.mobiles("pending")" class="btn btn-success btn-sm">Pending</a>
					<a id="demanded_button" href="@routes.AdminController.mobiles("proofdemanded")" class="btn btn-success btn-sm">Proof Demanded</a>
					<a id="approved_button" href="@routes.AdminController.mobiles("approved")" class="btn btn-success btn-sm">Approved</a>
				</div>
			</div>
			<hr>
			<div class="row">
			@flash.get("error").map { message =>
                <div class="alert alert-error col-md-12">
        			<strong>@message</strong>
      			</div>
            }
            
            @flash.get("success").map { message =>
                <div class="alert alert-success col-md-12">
        			<strong>@message</strong>
      			</div>
		}
		</div>
		<div class="row">
		<div class="col-md-12">
			@if(users.size > 0) {
            	<table id="userTable" class="table table-striped table-bordered" style="font-size: 16px;">
                    <thead>
                        <tr>
                        
                            <th>@Messages("mobile.name")</th>
							<th>@Messages("mobile.model")</th>
							<th>@Messages("mobile.imei")</th>
							<th>@Messages("mobile.purchaseDate")</th>
							<th>@Messages("mobile.email")</th>
							<th>@Messages("mobile.status")</th>
							<th>@Messages("mobile.proof")</th>
							<th>@Messages("mobile.approve")</th>
							<th>@Messages("mobile.demandProof")</th>
							<th>@Messages("mobile.delete")</th>
							<th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                       @for(mobile <- users) {
                        <tr>
                        <td>@mobile._1.userName</td>
			    			<td>@mobile._2</td>
			    			<td>@mobile._1.imeiMeid</td>
						    <td>@mobile._1.regDate</td>
						    <td>@mobile._1.email</td>
							<td>@mobile._1.regType</td>
							<td><button class="btn btn-primary btn-sm" onclick="showDocumentProof('@mobile._1.document')">Get Proof</button></td>
							@if(mobile._1.mobileStatus == Status(1)){
							<td><button id="approve" class="btn btn-primary btn-sm" onclick="changeStatus(@mobile._1.imeiMeid)" disabled>Approved</button></td>
						    }else{
						    <td><button id="approve" class="btn btn-primary btn-sm" onclick="changeStatus(@mobile._1.imeiMeid)">Approve</button></td>
						    }
						    @if(mobile._1.mobileStatus == Status(1) || mobile._1.mobileStatus == Status(2)){
							<td><button id="approve" class="btn btn-primary btn-sm" onclick="changeStatusToDemand(@mobile._1.imeiMeid)" disabled>Demand Proof</button></td>
						    }else{
						    <td><button id="approve" class="btn btn-primary btn-sm" onclick="changeStatusToDemand(@mobile._1.imeiMeid)">Demand Proof</button></td>
						    }
						    
						    <td><button class="btn btn-primary btn-sm" onclick="showDescription('@mobile._1.description')">View</button></td>
						
						    <td><button class="btn btn-danger btn-sm" onclick="deleteMobileUser(@mobile._1.imeiMeid)">Delete</button></td>
			    		
			    		</tr>
                 
                       }
                       </tbody>
                </table>
		} else {
			<div class="panel panel-default">
			  <div class="panel-body" style="background: #FFCCCC">
			    <em>No records!</em>
			  </div>
			</div>	
		}
		</div>
		</div>
		</div>
	
	 
	<!-- confirm modal dialog for delete mobile -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Delete mobile</h4>
      </div>
      <div class="modal-body" id="modalBody">Are you sure?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="deleteOk">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- model for description -->
	<div class="modal fade" id="myModall" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body" id="descr">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/DT_bootstrap.css")">
    <script src="@routes.Assets.at("javascripts/jquery.dataTables.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/DT_bootstrap.js")" type="text/javascript"></script>
    
    <script type="text/javascript">    
        $(document).ready(function() {
            $('#userTable').dataTable( {
                "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
                "sPaginationType": "bootstrap"    
            } );    
        } );
    </script>

	<script type="text/javascript">
		var imeId = "";
		function changeStatusToDemand(imeid) {
			imeId = imeid;
			changeStatusToDemandProof(imeid);
			sendMailForDemandProof(imeid); // for mail 
		}

		var statusAjaxSuccessDemandProof = function(data) {
			$("#demand_" + imeId).prop("disabled", true);
			$("#demand_" + imeId).text('Proof Demanded');
			console.debug("Success of Ajax Call for demand proof");
			console.debug(data);
		};

		var statusAjaxErrorDemandProof = function(err) {
			console.debug("Error of ajax Call for demand proof");
			console.debug(err);
		};

		var changeStatusToDemandProof = function(imeid) {

			var statusAjaxCallBackDemandProof = {
				success : statusAjaxSuccessDemandProof,
				error : statusAjaxErrorDemandProof
			};

			jsRoutes.controllers.AdminController.proofDemanded(imeid).ajax(
					statusAjaxCallBackDemandProof);
		};

		var sendMailForDemandProof = function(imeid) {
			var statusAjaxCallBackForSendMail = {
				success : statusAjaxSuccessForSendmail,
				error : statusAjaxErrorForSendmail
			};
			jsRoutes.controllers.AdminController.sendMailForDemandProof(imeid)
					.ajax(statusAjaxCallBackForSendMail)
		};

		var statusAjaxSuccessForSendmail = function(data) {
			console.debug("Success of Ajax Call");
			console.debug(data);
		};

		var statusAjaxErrorForSendmail = function(err) {
			console.debug("Error of ajax Call");
			console.debug(err);
		};

		function changeStatus(imeid) {
			imeId = imeid;
			changeStatusToApprove(imeid);
			sendMailForApprovedRequest(imeid);
		}

		var statusAjaxSuccess = function(data) {
			$("#approve_" + imeId).prop("disabled", true);
			$("#approve_" + imeId).text('approved');
			console.debug("Success of Ajax Call");
			console.debug(data);
		};

		var statusAjaxError = function(err) {
			console.debug("Error of ajax Call");
			console.debug(err);
		};

		var changeStatusToApprove = function(imeid) {

			var statusAjaxCallBack = {
				success : statusAjaxSuccess,
				error : statusAjaxError
			};

			jsRoutes.controllers.AdminController.approve(imeid).ajax(
					statusAjaxCallBack);
		};

		var sendMailForApprovedRequest = function(imeid) {
			var statusAjaxCallBackForSendMail = {
				success : statusAjaxSuccessForSendmail,
				error : statusAjaxErrorForSendmail
			};
			jsRoutes.controllers.AdminController.sendMailForApprovedRequest(
					imeid).ajax(statusAjaxCallBackForSendMail);
		};

		var statusAjaxSuccessForSendmail = function(data) {
			console.debug("Success of Ajax Call");
			console.debug(data);
		};

		var statusAjaxErrorForSendmail = function(err) {
			console.debug("Error of ajax Call");
			console.debug(err);
		};

		function showDocumentProof(documentProofId) {
			var newWindow = window.open("", "pictureViewer",
					"location=no, directories=no, resizable=yes, fullscreen=no, "
							+ "menubar=no, status=yes, toolbar=no, width="
							+ 800 + ", height=" + 700 + ", scrollbars=no");
			newWindow.document.writeln("<html>");
			newWindow.document.writeln("<body style='margin: 0 0 0 0;'>");
			newWindow.document.writeln("<a href='javascript:window.close();'>");
			newWindow.document
					.writeln('<img src=https://s3.amazonaws.com/voyager-email-attachments/'+documentProofId+'  id="bigImage"/>');
			newWindow.document.writeln("<br>");
			newWindow.document.writeln(alt = "Click to close");
			newWindow.document.writeln("</a>");
			newWindow.document.writeln("</body></html>");
			newWindow.document.close();
		}

		function showDescription(desc) {
			$('#myModall').modal('show');
			$('#descr').html(desc);
			}

			function deleteMobileUser(imeid) {
				$('#myModal').modal('show');
				$("#deleteOk").bind('click', function(){
					var statusAjaxCallBackForDeleteMobileUser = {
							success : ajaxSuccess,
							error : ajaxError
						};
						jsRoutes.controllers.AdminController.deleteMobile(imeid)
								.ajax(statusAjaxCallBackForDeleteMobileUser);
						$('#myModal').modal('hide');
				});
			}

		var ajaxSuccess = function(data) {
		  location.reload();
		  console.debug("Success of delete mobile Ajax Call");
		};
		 
		var ajaxError = function(error) {
		    alert(error);
		};
	</script>		
}
