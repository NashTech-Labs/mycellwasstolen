@(regType: String, mobileRegistrationForm:Form[model.repository.MobileRegisterForm], brands:List[model.repository.Brand])
@import helper._
@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.f)}
@helper.form(action =routes.MobileController.saveMobileUser, 'id->"mobileRegistrationForm",'enctype -> "multipart/form-data") {

<fieldset>
<style>

 input[type=text] { width: 200px;}

</style>

	<font color="red"><center>Note : All Fields Are Mandatory</center></font><br> <input type="hidden" name="regType" id="regType" value="@regType"> <input type="hidden" name="document" id="document" value="">
	@inputText(mobileRegistrationForm("userName"), '_label -> "Name",'class->"form-control")

	@select(field=mobileRegistrationForm("brandId"),options=brands.map(x=>
	(x.id.get.toString -> (x.name))).toSeq, '_label -> "Mobile Brand",
	'_default -> "-- Choose Brand Name --", '_showConstraints ->
	false,'class->"form-control",'_error ->
	mobileRegistrationForm("brandId").error.map(_.withMessage("Mobile Brand Required")))

	@select(field=mobileRegistrationForm("mobileModelId"),options=None.toSeq,
	'_label->"Mobile Model", '_default -> "-- Choose Mobile Model --",'class->"form-control",
	'_showConstraints -> false,'_error ->
	mobileRegistrationForm("mobileModelId").error.map(_.withMessage("Mobile Model Required")))
	
	<div class="control-group">
	<label class="col-sm-4 control-label" for="otherImeiCheckbox">IMEI number</label>
            <label class="checkbox inline col-sm-2">
                <input id="hide" type="radio" name="otherImeiCheckbox" checked="">Single 
            </label>
            <label class="checkbox inline col-sm-6">
                <input id="show" type="radio" name="otherImeiCheckbox"> Dual
            </label>
        </div>
        
        @inputText(mobileRegistrationForm("imeiMeid"), '_label -> "IMEI 1", 'maxlength -> 15,'class->"form-control")
	
	<div class="controls">
	       <div class="form-group collapse" id="check">
		<label class="col-sm-4 control-label" for="otherImei">IMEI 2</label>
		<div class="col-sm-6">
			<input id="otherImei" class="form-control" type="text" value="" name="otherImei">
		</div>
	</div>
	</div>

	@inputText(mobileRegistrationForm("email"), '_label -> "Email",'class->"form-control")

	@inputText(mobileRegistrationForm("contactNo"), '_label -> "Mobile No.",'_type->"tel", 'pattern->"[0123456789+ ]{13,17}",'title->"Mobile number must be of 13 to 17 digit with code", 'maxlength->17,'class->"form-control")

	@textarea(field=mobileRegistrationForm("description"), args = 'rows ->3, 'cols -> 22, '_label->"Description",'class->"form-control")
 
 <div class="form-group">
		<label class="col-sm-4 control-label" for="fileUpload">Document(Image)</label>
		<div class="col-sm-6">
			<input id="fileUpload" type="file" name="fileUpload">
		</div>
	</div>

</fieldset>

<div class="form-group">
	<div class="col-lg-10 col-lg-offset-4">
		<button class="btn btn-primary" type="submit" onClick="setValue();">Submit</button>
		<a href="/"  class="btn btn-default">Cancel</a>
	</div>
</div>
}

<script type="text/javascript">
	function setValue() {
		var file = $("#fileUpload").val();
		$("#document").val(file);
	}

	$(document).ready(function(){
	    $('#show').click(function(){
	          $('#check').collapse('show');
	      });
	    $('#hide').click(function(){
	    	$('#check').collapse('hide');
	      });
	});
	
	$("#contactNo").intlTelInput();

	$(document).ready(function() {
		$("#brandId").change(function() {
			var brandId = $(this).val();
			alert(brandId);
			var mobileName = $("#brandId option:selected").text();
			if (mobileName == "~Other") {
				$('#form-group-otherbrand').show();
				$('#otherMobileBrand').addClass('required');

			} else {
				$('#form-group-otherbrand').hide();
				$('#form-group-othermodel').hide();
				$('#otherMobileModel').removeClass('required');
				$('#otherMobileBrand').removeClass('required');
			}
			mobileModels(brandId);
		});
	});

	$("#mobileModelId").change(function() {
		var mobileModelId = $(this).val();
		var mobileModel = $("#mobileModelId option:selected").text();
		if (mobileModel.match(/~Other.*/)) {
			$('#form-group-othermodel').show();
			$('#otherMobileModel').addClass('required');
		} else {
			$('#otherMobileModel').removeClass('required');
			$('#form-group-othermodel').hide();
		}

	});

	var mobileAjaxSuccess = function(data) {
		$("#mobileModelId").empty();
		$('#mobileModelId').append($('<option>', {
			value : "-- Choose Mobile Model --",
			text : "-- Choose Mobile Model --"
		}));
		//console.log(data.toSource())
		$.each(data, function(i, d) {
			$('#mobileModelId').append($('<option>', {
				value : d.id,
				text : d.name
			}));
		});
		console.debug("Success of Ajax Call");
		console.debug(data);
	};

	var mobileAjaxError = function(err) {
		console.debug("Error of ajax Call");
		console.debug(err);
	};

	var mobileModels = function(brandId) {

		var mobileAjaxCallBack = {
			success : mobileAjaxSuccess,
			error : mobileAjaxError
		};
		jsRoutes.controllers.MobileController.getModels(brandId).ajax(
				mobileAjaxCallBack);
	};

	$("#mobileRegistrationForm").validate({
		rules : {
			imeiMeid : {
				required : true,
				remote : {
					url : '/isImeiExist',
					type : 'GET',
					data : {
						imeiId : function() {
							return $("#imeiMeid").val();
						}
					}
				}
			},
			otherImeiMeid : {
				remote : {
					url : '/isImeiExist',
					type : 'GET',
					data : {
						imeiId : function() {
							return $("#otherImeiMeid").val();
						}
					}
				}
			},
			email : {
				required : true,
				maxlength : 100,
				email : true,
			},
			userName : {
				required : true,
				maxlength : 100
			},
			mobileModelId : {
				required : true,
				maxlength : 100
			},
			brandId : {
				required : true,
				maxlength : 100
			},
			contactNo : {
				required : true,
				maxlength : 100
			},
			purchaseDate : {
				required : true,
				maxlength : 100

			},
			description : {
				required : true,
				maxlength : 500
			},
			fileUpload : {
				required : true,
				maxlength : 100
			}
		},
		messages : {
			imeiMeid : {
				remote : "Invalid imei Id or may be already exist."
			},
			otherImeiMeid : {
				remote : "Invalid imei Id or may be already exist."
			}
		}
	});

	// upload file validation
	$('#fileUpload').change(function() {
		return validateFileExtension(this)
	})
	function validateFileExtension(fld) {
		if (!/(\.bmp|\.gif|\.jpg|\.jpeg|\.png)$/i.test(fld.value)) {
			alert("Invalid image file type.");
			fld.form.reset();
			fld.focus();
			return false;
		}
		return true;
	}

	$('#imeiMeid').change(function() {
		return validateImeiMeid(this)
	})

	function validateImeiMeid(imei) {
		var imeiMeid = document.getElementById("imeiMeid").value;
		var pattern = /^[0-9]+$/;

		if (imeiMeid.length == 15) {
			if (pattern.test(imeiMeid)) {
				return true;
			} else {
				alert("IMEI is not in correct format");
				imei.form.elements['imeiMeid'].value = imei.form.elements['imeiMeid'].defaultValue;
				imei.focus();
				return false;
			}
		} else {
			alert("IMEI must be 15 digits !");
			imei.form.elements['imeiMeid'].value = imei.form.elements['imeiMeid'].defaultValue;
			imei.focus();
			return false;
		}

	}

	$('#otherImeiMeid').change(function() {
		return validateOtherImeiMeid(this)
	})

	function validateOtherImeiMeid(otherImei) {
		var otherImeiMeid = document.getElementById("otherImeiMeid").value;
		var pattern = /^[0-9]+$/;

		if (otherImeiMeid.length == 15) {
			if (pattern.test(otherImeiMeid)) {
				return true;
			} else {
				alert("IMEI is not in correct format");
				otherImei.form.elements['otherImeiMeid'].value = otherImei.form.elements['otherImeiMeid'].defaultValue;
				otherImei.focus();
				return false;
			}
		} else {
			alert("IMEI must be of 15 digits !");
			otherImei.form.elements['otherImeiMeid'].value = otherImei.form.elements['otherImeiMeid'].defaultValue;
			otherImei.focus();
			return false;
		}
	}
</script>
