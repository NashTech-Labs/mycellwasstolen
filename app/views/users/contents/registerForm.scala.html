@(regType: String, mobileRegistrationForm:Form[model.repository.MobileRegisterForm], brands:List[model.repository.Brand])
@import helper._
@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.f)}
@helper.form(action =routes.MobileController.saveMobileUser, 'id->"mobileRegistrationForm",'enctype -> "multipart/form-data") {
<fieldset>
<style>
 input[type=text] { width: 300px;}
</style>
	<font color="red"><center>Note : All Fields Are Mandatory</center></font><br> <input type="hidden" name="regType" id="regType" value="@regType"> <input type="hidden" name="document" id="document" value="">
	@inputText(mobileRegistrationForm("userName"), '_label -> "Name",'class->"form-control")
	@select(field=mobileRegistrationForm("brandId"),options=brands.map(x=>
	(x.id.get.toString -> (x.name))).toSeq, '_label -> "Mobile Brand",
	'_default -> "-- Choose Brand Name --", '_showConstraints ->
	false,'class->"form-control",'_error ->
	mobileRegistrationForm("brandId").error.map(_.withMessage("Mobile Brand Required")))

	@select(field=mobileRegistrationForm("modelId"),options=None.toSeq,
	'_label->"Mobile Model", '_default -> "-- Choose Mobile Model --",'class->"form-control",
	'_showConstraints -> false,'_error ->
	mobileRegistrationForm("modelId").error.map(_.withMessage("Mobile Model Required")))
	
	<div class="form-group">
    <label class="col-sm-4 control-label">IMEI number</label>
    <label class="radio-inline col-sm-2" style="padding-left: 50px">
        <input type="radio" class="single" name="when" value="single" checked> <strong>Single</strong>
    </label>
    <label class="radio-inline col-sm-2">
        <input type="radio" class="dual" name="when" value="dual"> <strong>Dual</strong>
    </label>
</div>
<div class="col-sm-12">
    <div class="collapse single">
        @inputText(mobileRegistrationForm("imei"), '_label -> "IMEI 1", 'maxlength -> 15,'class->"form-control")
    </div>
    
    <div class="collapse dual">
@inputText(mobileRegistrationForm("imei"), '_label -> "IMEI 1", 'maxlength -> 15,'class->"form-control")
@inputText(mobileRegistrationForm("otherImei"), '_label -> "IMEI 2", 'maxlength -> 15,'class->"form-control")
</div>
</div>
	
	@inputText(mobileRegistrationForm("email"), '_label -> "Email",'class->"form-control")

	@inputText(mobileRegistrationForm("contactNo"), '_label -> "Mobile No.",'_type->"tel", 'pattern->"[0123456789+ ]{13,17}",'title->"Mobile number must be of 13 to 17 digit with code", 'maxlength->17,'class->"form-control")
 
 <div class="form-group">
		<label class="col-sm-4 control-label" for="fileUpload">Document(Image)</label>
		<div class="col-sm-6">
			<input id="fileUpload" type="file" name="fileUpload">
		</div>
	</div>

</fieldset>

<div class="form-group">
	<div class="col-lg-10 col-lg-offset-4">
		<button class="btn btn-primary" type="submit" onClick="setValue();">Submit</button>
		<a href="/"  class="btn btn-default">Cancel</a>
	</div>
</div>
}

<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="@routes.Assets.at("user/js/jquery.validate.min.js")"></script>
<script src="@routes.Assets.at("user/js/intlTelInput.min.js")" type="text/javascript"></script>
<script type="text/javascript">
	function setValue() {
		var file = $("#fileUpload").val();
		$("#document").val(file);
	}

	$('input[type=radio]').on('change', function() {
		if (!this.checked)
			return

		$('.collapse').not($('div.' + $(this).attr('class'))).slideUp();
		$('.collapse.' + $(this).attr('class')).slideDown();
	});

	$("#contactNo").intlTelInput();

	$(document).ready(function() {
		$("#brandId").change(function() {
			var brandId = $(this).val();
			mobileModels(brandId);
		});
	});

	var modelAjaxSuccess = function(data) {
		$("#modelId").empty();
		$('#modelId').append($('<option>', {
			value : "-- Choose Mobile Model --",
			text : "-- Choose Mobile Model --"
		}));

		$.each(data, function(i, d) {
			$('#modelId').append($('<option>', {
				value : d.id,
				text : d.name
			}));
		});
		console.debug("Success of Ajax Call");
		console.debug(data);
	};

	var modelAjaxError = function(err) {
		console.debug("Error of ajax Call");
		console.debug(err);
	};

	var mobileModels = function(brandId) {
		var mobileAjaxCallBack = {
			success : modelAjaxSuccess,
			error : modelAjaxError
		};
		jsRoutes.controllers.MobileController.getModels(brandId).ajax(
				mobileAjaxCallBack);
	};

	$("#mobileRegistrationForm").validate({
		rules : {
			imei : {
				required : true,
				remote : {
					url : '/check_imei',
					type : 'GET',
					data : {
						imeiId : function() {
							return $("#imei").val();
						}
					}
				}
			},
			otherImei : {
				remote : {
					url : '/check_imei',
					type : 'GET',
					data : {
						imeiId : function() {
							return $("#otherImei").val();
						}
					}
				}
			},
			email : {
				required : true,
				maxlength : 100,
				email : true,
			},
			userName : {
				required : true,
				maxlength : 100
			},
			modelId : {
				required : true,
				maxlength : 100
			},
			brandId : {
				required : true,
				maxlength : 100
			},
			contactNo : {
				required : true,
				maxlength : 100
			},
			fileUpload : {
				required : true,
				maxlength : 100
			}
		},
		messages : {
			imei : {
				remote : "Invalid imei Id or may be already exist."
			},
			otherImei : {
				remote : "Invalid imei Id or may be already exist."
			}
		}
	});

	// upload file validation
	$('#fileUpload').change(function() {
		return validateFileExtension(this)
	})
	function validateFileExtension(fld) {
		if (!/(\.bmp|\.gif|\.jpg|\.jpeg|\.png)$/i.test(fld.value)) {
			alert("Invalid image file type.");
			fld.form.reset();
			fld.focus();
			return false;
		}
		return true;
	}

	$('#imei').change(function() {
		return validateImeiMeid(this)
	})

	function validateImeiMeid(imei) {
		var imeiMeid = document.getElementById("imei").value;
		var pattern = /^[0-9]+$/;

		if (imeiMeid.length == 15) {
			if (pattern.test(imeiMeid)) {
				return true;
			} else {
				alert("IMEI is not in correct format");
				imei.form.elements['imei'].value = imei.form.elements['imei'].defaultValue;
				imei.focus();
				return false;
			}
		} else {
			alert("IMEI must be 15 digits !");
			imei.form.elements['imei'].value = imei.form.elements['imei'].defaultValue;
			imei.focus();
			return false;
		}

	}

	$('#otherImei').change(function() {
		return validateOtherImeiMeid(this)
	})

	function validateOtherImeiMeid(otherImei) {
		var otherImeiMeid = document.getElementById("otherImei").value;
		var pattern = /^[0-9]+$/;

		if (otherImeiMeid.length == 15) {
			if (pattern.test(otherImeiMeid)) {
				return true;
			} else {
				alert("IMEI is not in correct format");
				otherImei.form.elements['otherImei'].value = otherImei.form.elements['otherImei'].defaultValue;
				otherImei.focus();
				return false;
			}
		} else {
			alert("IMEI must be of 15 digits !");
			otherImei.form.elements['otherImei'].value = otherImei.form.elements['otherImei'].defaultValue;
			otherImei.focus();
			return false;
		}
	}
</script>